# KKoishi STG Engine

è¿™æ¬¾STGå¼•æ“ä¸ºä¸€ä¸ªè½»é‡çš„STGå¼•æ“ï¼Œå…¶ä½¿ç”¨Java2Då’ŒJava2Dè‡ªå¸¦çš„OpenGLç¡¬ä»¶åŠ é€Ÿè¿›è¡Œæ¸²æŸ“ã€‚ å®ƒå¯ä»¥è®©ä½ è¾ƒè½»æ¾çš„å®ç°ä¸€ä¸ªstgçš„åŸºæœ¬åŠŸèƒ½ã€‚

This STG engine is a lightweight STG engine, which uses Java2D and the hardware acceleration implemented by OpenGL in Java2D for rendering, and it allows you to implement the basic functions of a STG easily.

å¼€å¯ç¡¬ä»¶åŠ é€Ÿçš„JVMå‚æ•°:

JVM parameters for enabling hardware acceleration:
```vmoptions 
-Dsun.java2d.ddscale=true
-Dsun.java2d.opengl=true
-Dswing.aatext=true
-Dawt.nativeDoubleBuffering=true
```
æˆ–è€…ä½¿ç”¨ä¸‹é¢çš„mainæ–¹æ³•æ¨¡æ¿:

Or use the following main method template:
```kotlin
//kotlin
object Test {
    @JvmStatic
    fun main(args: Array<String>) {
        System.setProperty("sun.java2d.ddscale", "true")
        System.setProperty("sun.java2d.opengl", "true")
        System.setProperty("swing.aatext", "true")
        System.setProperty("awt.nativeDoubleBuffering", "true")
        // your codes
    }
}
```
```java
//java
public class Test {
    public static void main (String[] args) {
        System.setProperty("sun.java2d.ddscale", "true");
        System.setProperty("sun.java2d.opengl", "true");
        System.setProperty("swing.aatext", "true");
        System.setProperty("awt.nativeDoubleBuffering", "true");
        // your codes
    }
}
```

## âš  æ³¨æ„äº‹é¡¹
> æœ¬é¡¹ç›®ä»…ä¸ºä¸ªäººå…´è¶£è€Œåˆ¶ä½œï¼Œå¼€å‘ç›®çš„åœ¨äºå­¦ä¹ å’Œæ¢ç´¢ï¼Œä¸€åˆ‡å¼€å‘çš†åœ¨å­¦ä¹ ï¼Œè¯·å‹¿ç”¨äºéæ³•ç”¨é€”ã€‚å› ä½¿ç”¨æœ¬é¡¹ç›®äº§ç”Ÿçš„ä¸€åˆ‡é—®é¢˜ä¸åæœç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ï¼Œé¡¹ç›®å¼€å‘è€…ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚
> 
> æµ‹è¯•ç”¨ä¾‹çš„ç´ æä»…ä¸ºæä¾›æ•ˆæœå‚è€ƒã€‚

> This project is only made for personal interest. The purpose of development is to learn and explore. All development is for learning. Please do not use it for illegal purposes. 
> All problems and consequences arising from the use of this project shall be borne by the user, and the project developer shall not bear any responsibility. 
>
> The material of the test case is only for reference.

## ğŸ•‘ å¯åŠ¨æ–¹æ³•
- è¯·ä¿è¯æ‚¨å…·æœ‰ä¸€å®šçš„jvmè¯­è¨€åŸºç¡€ã€‚
- åœ¨ç¼–è¯‘c++å®ç°çš„å¯åŠ¨ç¨‹åºå‰ï¼Œè¯·ä¿®æ”¹jaråŒ…è·¯å¾„ç­‰éƒ¨åˆ†ä»£ç ä¸ºæ‚¨éœ€è¦çš„å†…å®¹ã€‚
- ä¸‹é¢çš„ä»…ä¸ºè¯´æ˜ç¤ºä¾‹ï¼Œå…·ä½“å®ç°è¯·å‚è€ƒ```top.kkoishi.stg.test.Test```
- æ­£å¸¸æ„å»ºjaråŒ…å(ç›´æ¥æ”¾classæ–‡ä»¶ä¹Ÿè¡Œï¼Œä½ éšæ„:D)ï¼Œå¯ä»¥è‡ªå·±å®ç°ä¸€å¥—å¯åŠ¨æµç¨‹/å¯åŠ¨è„šæœ¬ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹å¹¶ç¼–è¯‘åœ¨cpp_bootstrapperç›®å½•ä¸­æä¾›çš„å¯åŠ¨ç¨‹åºã€‚

- Please ensure that you have a certain jvm language foundation.
- Before compiling the startup program implemented by c++, please modify some codes such as the jar path to the content you need.
- The following codes is just an example, please refer to the detailed implementation```top.kkoishi.stg.test.Test```
- After building and packaging the jar file normally (you can directly use the class files:D), you can implement the startup processes or startup scripts, or just simply modify and compile the startup program provided in the cpp_bootstrapper directory.
```kotlin
//kotlin
val f = JFrame("KKoishi_ STG Engine test")
// TODO: custom the JFrame
f.isVisible = true
// TODO: KeyBinds, you can use your key binds, and this is just an example
PlayerManager.keyBinds(
    f,
    Player.VK_C,
    Player.VK_DOWN,
    Player.VK_ESCAPE,
    Player.VK_LEFT,
    Player.VK_RIGHT,
    Player.VK_SHIFT,
    Player.VK_UP,
    Player.VK_X,
    Player.VK_Z,
    KeyEvent.VK_F11
)
Graphics.refresh(f)

// TODO: init menu, or stages and so on.
// next step is set the game state.
GenericFlags.gameState.set(GenericFlags.STATE_MENU)

val inst = Threads.getInstance()
InfoSystem.start(inst)
Renderer.start(inst)
GameLoop.start(inst)
AudioPlayer.start(inst)
```
- ### æ³¨æ„äº‹é¡¹
> - è‡ªå®šä¹‰JFrameæ—¶ï¼Œè‹¥æ‚¨éœ€è¦å…¨å±æ˜¾ç¤ºï¼Œåº”è¯¥å…ˆä½¿ç”¨```setUndecorated(true)```ï¼Œ
> ç„¶åç”¨[Graphics](./src/main/kotlin/top/kkoishi/stg/gfx/Graphics.kt)ä¸­çš„setScreenSize setBufferSizeå»æ­£ç¡®è®¾ç½®å¤§å°ï¼Œ
> æœ€åè®©JFrameå…¨å±å¹¶ä¸”è°ƒç”¨Render.fullScreen()ã€‚
> - å¦‚æœæ‚¨éœ€è¦æ·»åŠ [SideBar](./src/main/kotlin/top/kkoishi/stg/common/ui/SideBar.kt)ï¼Œè¿˜éœ€è¦ä½¿ç”¨Graphics.setUIInsetså»è®¾ç½®UIè¾¹æ¡†å¤§å°ã€‚
> - Graphics.refreshæ–¹æ³•åº”è¯¥åœ¨JFrame.setVisibleä¹‹åè°ƒç”¨ï¼Œæ‰èƒ½æ­£å¸¸åˆ›å»ºGraphics2Dã€‚

- ### é€»è¾‘
> - [GenericFlags](./src/main/kotlin/top/kkoishi/stg/logic/GenericFlags.kt).gameStateç”¨äºæ ‡è¯†å½“å‰æ¸¸æˆçŠ¶æ€ã€‚
> - å½“å…¶ä¸ºGenericFlags.STATE_MENUæ—¶ï¼Œåªæœ‰[ObjectPool](./src/main/kotlin/top/kkoishi/stg/logic/ObjectPool.kt).uiObjectä¸­çš„å®ä¾‹ä¼šè¢«æ¸²æŸ“ã€‚
> - å½“å…¶ä¸ºGenericFlags.PLAYINGæ—¶ï¼ŒObjectPoolä¸­æ‰€æœ‰å¯¹è±¡å®ä¾‹ä»¥åŠplayerå‡ä¼šè¢«æ¸²æŸ“ã€‚
> - æ‚¨éœ€è¦åšçš„å°±æ˜¯åœ¨åˆ‡æ¢çŠ¶æ€ä¹‹å‰æ­£ç¡®çš„æŠŠå®ä¾‹ä¸€è‚¡è„‘ä¸¢è¿›å»å³å¯ã€‚
> - æœ¬å¼•æ“æä¾›äº†ä¸€å¥—è„šæœ¬æ¥åŠ è½½æè´¨éŸ³é¢‘ç­‰ã€‚
> ---
> 
> - å®ç°åŸºæœ¬è¦æ±‚çš„ç±»å‡ä½äº[top.kkoishi.stg.common](./src/main/kotlin/top/kkoishi/stg/common/package-info.java)åŒ…å†…ï¼Œï¼ˆé€šå¸¸ï¼‰åªç”¨ç»§æ‰¿å®ç°ä»–ä»¬çš„é€»è¾‘ã€‚
> - top.kkoishi.stg.commonä¸­æ‰€æœ‰å¯æ¸²æŸ“å¯¹è±¡éƒ½å®ç°æ¥å£top.kkoishi.stg.common.entities.Objectï¼ŒåŒ…å«æ›´æ–°é€»è¾‘ã€ç¢°æ’æ£€æµ‹åŠæ¸²æŸ“ã€‚
> - æ‰€æœ‰å®ä½“ï¼ˆ[Player](./src/main/kotlin/top/kkoishi/stg/common/entities/Player.kt), [Boss](./src/main/kotlin/top/kkoishi/stg/common/entities/Boss.kt), [Enemy](./src/main/kotlin/top/kkoishi/stg/common/entities/Enemy.kt), [Item](./src/main/kotlin/top/kkoishi/stg/common/entities/Item.kt), [Bullet](./src/main/kotlin/top/kkoishi/stg/common/entities/Bullet.kt)ï¼‰éƒ½åœ¨top.kkoishi.stg.common.entitiesåŒ…å†…ï¼ŒåŒæ—¶åŒ…é‡Œæœ‰ä¸€äº›æŠ½è±¡ç±»ï¼ˆä»¥Base/Abstractå¼€å¤´ï¼Œéƒ¨åˆ†ä½äº[Defaults.kt](./src/main/kotlin/top/kkoishi/stg/common/entities/Defaults.kt)ä¸­ï¼‰æ¥é™ä½å®ç°éš¾åº¦ï¼Œè€Œé™¤äº†Bulletè¿™äº›ç±»å‡ç»§æ‰¿äº†Entityç±»ã€‚
> - top.kkoishi.stg.common.uiåŒ…è´Ÿè´£uiæ¸²æŸ“ï¼Œæä¾›äº†ä¸€ç³»åˆ—ç±»æ¥æ¸²æŸ“uiï¼Œåªéœ€è¦å®ç°å¹¶ä¸¢è¿›ObjectPool.uiObjectã€‚
> - å…¶ä½™çš„ç±»ä¸ºæ¸¸æˆé€»è¾‘ï¼ŒåŒ…æ‹¬bossé€»è¾‘BossActionã€StageåŠå…¶é€»è¾‘StageActionå’Œç±»ScreenRenderObjectã€‚
> ---
> 
> - å¼•æ“æ•´ä½“é€»è¾‘ä¸ºå…ˆæ¸²æŸ“ã€ç„¶åè®¡ç®—ï¼Œæœ€åæ’­æ”¾audioï¼Œå¤§ä½“åŒ…å«å››ä¸ªä¸»è¦çº¿ç¨‹ï¼šInfoSystemã€Rendererã€GameLoopã€AudioPlayerï¼ŒåŒæ—¶åŒ…å«ä¸€ä¸ªCrashHandleå­è¿›ç¨‹ï¼ˆå¯é€‰ï¼‰

(READMEæœªå®Œæˆ)

## çº¿ç¨‹å¼‚å¸¸å¤„ç†å’Œå•ä¸€å®ä¾‹

## [è„šæœ¬è¯´æ˜](./test/scripts.md)

## å¼•æ“ç»“æ„
```
top.kkoishi.stg
            â”œâ”€audio
            â”œâ”€boot
            â”‚  â”œâ”€jvm
            â”‚  â””â”€ui
            â”œâ”€common
            â”‚  â”œâ”€entities
            â”‚  â””â”€ui
            â”œâ”€exceptions
            â”œâ”€gfx
            â”‚  â””â”€replay
            â”œâ”€logic
            â””â”€script
```